<script>
  // Initialize and add the map
  function initMap() {
    function placeCase(item, map, icons) {
      var case_position = {
        lat: item.lat,
        lng: item.lng
      };
      var icon = icons[0]

      if (item.stadium === main_stadium) {
        icon = icons[1];
      }

      var marker = new google.maps.Marker({
        position: case_position,
        map: map,
        icon: icon,
        title: item.case_reason + ', ' + item.stadium,
      });
    }

    var map = new google.maps.Map(
      document.getElementById('map'), {
        zoom: 13,
        center: {
          lat: 52.379189,
          lng: 4.899431
        },
        disableDefaultUI: true
      });

    var planning = JSON.parse(document.getElementById('planning').textContent);
    // TODO: Uncomment this when planning is working again
    var unplanned_cases = []; //planning['unplanned_cases']
    var planned_cases = []; //planning['lists']

    // Place the unused cases
    icons = getUnusedPin();

    for (var i = 0; i < unplanned_cases.length; i++) {
      var item = unplanned_cases[i];
      placeCase(item, map, icons);
    }


    // Place the planned cases
    for (var i = 0; i < planned_cases.length; i++) {
      var lists = planned_cases[i]['itineraries'];
      for (var x = 0; x < lists.length; x++) {
        var list = lists[x];
        var icons = getIndexedColorPin(x);

        for (var j = 0; j < list.length; j++) {
          var item = list[j];
          placeCase(item, map, icons);
        }
      }
    }
  }
</script>